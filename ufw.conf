# /etc/ufw/ufw.conf
# UFW configuration file for Debian-based systems

# Enable UFW by default
ENABLED=yes

# Set the default policies to deny all incoming traffic and allow outgoing traffic
DEFAULT_INPUT_POLICY="DROP"
DEFAULT_OUTPUT_POLICY="ACCEPT"
DEFAULT_FORWARD_POLICY="DROP"

# Allow established and related incoming connections
IPT_MODULES="nf_conntrack_ftp nf_nat_ftp nf_conntrack_netbios_ns nf_nat_sip"

# Define logging level (levels: off, low, medium, high, full)
LOGLEVEL=medium

# Enable IPv6 support
IPV6=yes

# Pre-configured rules for common services
# Allow SSH
ufw allow ssh

# Allow HTTP and HTTPS
ufw allow http
ufw allow https

# Enable logging for all denied incoming connections
ufw logging on

# Check for suspicious activity
# Using fail2ban for additional protection

# Install fail2ban if not installed
if ! command -v fail2ban-client &> /dev/null; then
    apt-get update && apt-get install -y fail2ban
fi

# Start fail2ban to monitor and ban IPs with suspicious activity
systemctl enable fail2ban
systemctl start fail2ban

# Ensure the system is configured securely before applying UFW rules
ufw --force enable
